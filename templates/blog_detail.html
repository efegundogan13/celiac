{% extends 'base.html' %}
{% block title %}{{ blog.title }}{% endblock %}

{% block content %}
  <div class="max-w-4xl mx-auto">

    <!-- Blog BaÅŸlÄ±ÄŸÄ± -->
    <h1 class="text-3xl font-bold text-green-700 mb-4">{{ blog.title }}</h1>

    <!-- Blog Bilgileri -->
    <p class="text-gray-500 text-sm mb-6">
      ğŸ“‚ {{ blog.category.name }} | {{ blog.created_at.strftime('%d.%m.%Y') }}
    </p>

    <!-- Blog GÃ¶rseli -->
    {% if blog.image_url %}
      <div class="mb-6 flex justify-center">
        <img src="{{ blog.image_url }}" class="rounded shadow w-full max-h-[400px] object-contain" alt="{{ blog.title }}">
      </div>
    {% endif %}

    <!-- Blog Ä°Ã§eriÄŸi -->
    <div class="prose max-w-none text-gray-800">
      {{ blog.content | safe }}
    </div>

    <!-- Admin Ä°Ã§in DÃ¼zenle ve Sil ButonlarÄ± -->
    {% if session.get('is_admin') %}
      <div class="flex space-x-4 mt-6">
        <a href="{{ url_for('edit_blog', blog_id=blog.id) }}" class="text-blue-600 hover:underline text-sm">âœï¸ Blogu DÃ¼zenle</a>

        <form action="{{ url_for('delete_blog', blog_id=blog.id) }}" method="POST"
              onsubmit="return confirm('Blogu silmek istediÄŸine emin misin?');">
          <button type="submit" class="text-red-600 hover:underline text-sm">ğŸ—‘ï¸ Blogu Sil</button>
        </form>
      </div>
    {% endif %}

    <!-- BeÄŸeni Butonu -->
    {% if session.get('user_id') %}
      <div class="mt-6">
        <a href="/blogs/{{ blog.id }}/like" class="bg-green-700 text-white px-4 py-2 rounded hover:bg-green-800">
          ğŸ‘ {{ blog.likes | length }} BeÄŸeni
        </a>
      </div>
    {% endif %}

    <!-- Yorum Ekleme Formu -->
    {% if session.get('user_id') %}
      <div class="mt-10">
        <h2 class="text-xl font-bold text-green-700 mb-4">Yorum Yap</h2>

        <form method="POST" action="{{ url_for('add_blog_comment', blog_id=blog.id) }}" class="space-y-4">
          <textarea name="text" class="w-full p-3 border rounded" rows="4" placeholder="Yorumunuzu yazÄ±n..." required></textarea>

          <button type="submit" class="bg-green-700 text-white px-6 py-2 rounded hover:bg-green-800">
            GÃ¶nder
          </button>
        </form>
      </div>
    {% else %}
      <p class="text-gray-600 text-sm mt-10">
        Yorum yapabilmek iÃ§in <a href="/login" class="text-green-700 hover:underline">giriÅŸ yap</a>.
      </p>
    {% endif %}

    <!-- Yorumlar Listesi -->
    <div class="mt-10">
      <h2 class="text-2xl font-bold text-green-700 mb-4">Yorumlar</h2>

      {% if blog.comments %}
        {% for comment in blog.comments %}
          <div class="bg-white p-4 rounded shadow mb-4">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold">{{ comment.user.username }}</span>
              <span class="text-xs text-gray-400">{{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
            </div>
            <p class="text-gray-700 mb-2">{{ comment.text }}</p>

            {% if session.get('user_id') == comment.user_id or session.get('is_admin') %}
              <div class="flex items-center space-x-4 mt-2">

                <a href="{{ url_for('edit_blog_comment', comment_id=comment.id) }}"
                   class="flex items-center space-x-1 text-blue-600 text-xs hover:underline">
                  <span>âœï¸</span> <span>DÃ¼zenle</span>
                </a>

                <form action="{{ url_for('delete_blog_comment', comment_id=comment.id) }}" method="POST"
                      onsubmit="return confirm('Yorumu silmek istediÄŸinize emin misiniz?');"
                      class="flex items-center space-x-1">
                  <button type="submit" class="flex items-center text-red-600 text-xs hover:underline">
                    <span>ğŸ—‘ï¸</span> <span>Sil</span>
                  </button>
                </form>

              </div>
            {% endif %}
          </div>
        {% endfor %}
      {% else %}
        <p class="text-gray-600 text-sm">HenÃ¼z yorum yapÄ±lmamÄ±ÅŸ.</p>
      {% endif %}
    </div>

    <!-- Geri DÃ¶n Linki -->
    <div class="mt-10">
      <a href="/blogs" class="text-green-700 hover:underline text-sm">â† TÃ¼m Bloglara DÃ¶n</a>
    </div>

  </div>
{% endblock %}
